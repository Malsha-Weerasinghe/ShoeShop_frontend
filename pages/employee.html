<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <title>Employee Information</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-image: url("../images/stockists-mobile.webp");
            background-size: cover;
            background-repeat: no-repeat;
            background-attachment: fixed;
            padding: 20px;
        }
        body::before {
            content: "";
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.2); /* Adjust the alpha value (0-1) for desired opacity */
            z-index: -1; /* Ensure the overlay is behind the content */
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
        }
        h2 {
            text-align: center;
            margin-bottom: 20px;
            color: white;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            padding-right: 60px;
            background-color: white;
            margin-left: -392px;
        }
        table, th, td {
            border: 1px solid #ccc;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border: 1px solid #dddddd;
        }
        th {
            background-color: #DAA520;
            color: #fff;
        }
        tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        form {
            background-color: #fff;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }
        label {
            font-weight: bold;
        }
        input, select {
            width: calc(100% - 22px);
            padding: 8px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 5px;
            box-sizing: border-box;
        }
        button {
            /*width: 100%;*/
            padding: 10px;
            background-color: #0eba33;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background-color: #093b11;
        }
        .backBtn {
            position: fixed; /* Set position to fixed */
            top: 20px; /* Adjust top position */
            left: 20px; /* Adjust left position */
            width: 50px;
            height: auto;
            border: 2px solid #090808;
            background-color: rgba(255, 255, 255, 0.5);
            border-radius: 10px;
            overflow: hidden;
            text-align: center;
            transition: transform 0.3s ease; /* Add transition effect */
        }

        .backBtn:hover {
            transform: scale(1.1); /* Increase size on hover */
        }

        .backBtn img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        /* Optional: Add margin-top to create space between the form and the table */
        #employeeForm {
            margin-bottom: 20px;
        }



    </style>
</head>
<body>
<div class="container">
    <h2>Employee Information Form</h2>
    <div class="backBtn" onclick="goBack()">
        <img src="../images/back.png" alt="Image">
    </div>
    <div class="container mt-5 mb-5"> <!-- Added mb-5 for bottom margin -->
        <div class="row">
            <div class="col-md-6">
                <div class="input-group">
                    <input type="text" class="form-control" placeholder="Enter Employee ID" aria-label="Enter Customer ID" aria-describedby="search-button">
                    <div class="input-group-append">
                        <button class="btn btn-primary" type="button" id="searchEmployee">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="form-container">
    <form id="employeeForm">
        <label for="employeeCode">Employee Code</label>
        <input type="text" id="employeeCode" name="employeeCode" required>

        <label for="employeeName">Employee Name</label>
        <input type="text" id="employeeName" name="employeeName" required>

        <label for="proPic">Profile Picture (Base64)</label>
        <input type="file" id="proPic" name="proPic">

        <label for="gender">Gender</label>
        <select id="gender" name="gender">
            <option value="Select">Select</option>
            <option value="MALE">Male</option>
            <option value="FEMALE">Female</option>
            <option value="OTHER">Other</option>
        </select>

        <label for="status">Status</label>
        <input type="status" id="status" name="status">

        <label for="designation">Designation</label>
        <select id="designation" name="designation">
            <option value="Select">Select</option>
            <option value="MANAGER">MANAGER</option>
            <option value="SUPERVISOR">SUPERVISOR</option>
            <option value="CASHIER">CASHIER</option>
        </select>

        <label for="role">Access Role</label>
        <select id="role" name="role">
            <option value="Select">Select</option>
            <option value="ADMIN">ADMIN</option>
            <option value="USER">USER</option>
        </select>

        <label for="dob">Date of Birth</label>
        <input type="date" id="dob" name="dob">

        <label for="joinDate">Date of Join</label>
        <input type="date" id="joinDate" name="joinDate">

        <label for="attachedBranch">Attached Branch</label>
        <input type="text" id="attachedBranch" name="attachedBranch">

        <label for="addressLine01">Address Line 01</label>
        <input type="text" id="addressLine01" name="addressLine01">

        <label for="addressLine02">Address Line 02</label>
        <input type="text" id="addressLine02" name="addressLine02">

        <label for="addressLine03">Address Line 03</label>
        <input type="text" id="addressLine03" name="addressLine03">


        <label for="contact">Contact No.</label>
        <input type="tel" id="contact" name="contact">

        <label for="email">Email</label>
        <input type="email" id="email" name="email">

        <label for="guardian">Emergency Contact Person</label>
        <input type="text" id="guardian" name="guardian">

        <label for="emergContact">Emergency Contact</label>
        <input type="tel" id="emergContact" name="emergContact">

       <!-- <img id="img" src="../assets/images/home.jpg" width="300px">

        <input type="file" id="imgInput" accept="image/*" style="display: none">-->

        <button type="button" class="btn btn-success" id="btnAddEmployee" >Save</button>
        <button type="button" class="btn btn-danger" id="btnDeleteEmployee">Delete</button>
        <button type="button" class="btn btn-warning" id="btnUpdateEmployee">Update</button>
    </form>
</div>

    <h2>Employee Information Table</h2>

                <table>
                    <thead>
                    <tr>
                        <th>Employee Code</th>
                        <th>Employee Name</th>
                        <th>Profile Picture</th>
                        <th>Gender</th>
                        <th>Status</th>
                        <th>Designation</th>
                        <th>Access Role</th>
                        <th>Date of Birth</th>
                        <th>Date of Join</th>
                        <th>Attached Branch</th>
                        <th>Address</th>
                        <th>Contact No.</th>
                        <th>Email</th>
                        <th>Emergency Contact Person</th>
                        <th>Emergency Contact</th>
                    </tr>
                    </thead>
                    <tbody id="employeeTable">
                    <!-- Employee data will be populated here -->
                    </tbody>
                </table>
</div>
<script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
<script src="../bootstrap/js/jquery-3.7.1.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
    function goBack() {
        window.history.back();
    }



    getAllEmployees();

    /*getAll Employees*/
    function getAllEmployees(){
        $.ajax({
            url: "http://localhost:8080/employee/getAllEmployees",
            method: "GET",
            dataType: "json",
            success: function (response) {
                console.log(response);
                console.log(response.length);
                console.log("success to load employees")
                loadEmployeeDataInTable(response);
                generateEmployeeID();
            },
            error: function (xhr, status, err) {
                console.log("Fail to load employees")
                console.log(err)
            }
        })
    }

    /*load employee into table*/
    function loadEmployeeDataInTable(employees) {
        var tableBody = document.getElementById("employeeTable");
        tableBody.innerHTML = "";

        employees.forEach(function (employee) {
            var row = document.createElement("tr");

            ["employeeCode", "employeeName", "proPic", "gender", "status", "attachedBranch", "designation", "role",
                "dob", "joinDate", "address", "contact", "email", "guardian", "emergContact"].forEach(function (property) {
                var cell = document.createElement("td");
                cell.textContent = employee[property];
                row.appendChild(cell);
            });
            tableBody.appendChild(row);
        });

    }

    window.onload = function() {
        loadEmployeeDataInTable();
    };


    /*Save employee*/

    $("#btnAddEmployee").click(function (){
        saveEmployee();
    })
    function saveEmployee(){
        const employeeCode = document.getElementById('employeeCode').value;
        const employeeName = document.getElementById('employeeName').value;
        const proPic = document.getElementById('proPic').value;
        const gender = document.getElementById('gender').value;
        const status= document.getElementById('status').value;
        const attachedBranch = document.getElementById('attachedBranch').value;
        const designation = document.getElementById('designation').value;
        const role = document.getElementById('role').value;
        const dob = document.getElementById('dob').value;
        const joinDate = document.getElementById('joinDate').value;
        const addressLine01 = $("#addressLine01").val();
        const addressLine02 = $("#addressLine02").val();
        const addressLine03 = $("#addressLine03").val();
        const contact = document.getElementById('contact').value;
        const email = document.getElementById('email').value;
        const guardian = document.getElementById('guardian').value;
        const emergContact = document.getElementById('emergContact').value;

        const employee = {
            employeeCode:employeeCode,
            employeeName:employeeName,
            proPic:proPic,
            gender:gender,
            status:status,
            attachedBranch:attachedBranch,
            designation:designation,
            role:role,
            dob:dob,
            joinDate:joinDate,
            address: `${addressLine01}, ${addressLine02}, ${addressLine03}`,
            contact:contact,
            email:email,
            guardian:guardian,
            emergContact:emergContact
        }

        $.ajax({
            url: 'http://localhost:8080/employee/save',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(employee),
            success: function (response) {
                console.log(response);
                alert('Employees information saved successfully!');
                getAllEmployees();
            },
            error: function (xhr, status, error) {
                console.error(error);
                alert('Failed to save employee information. Please try again.');
            }
        });
    }

    /*table click*/
   /* $('#employeeTable').on('click', 'tr', function (){
        var employeeCode = $(this).find('td:eq(0)').text();
        var employeeName = $(this).find('td:eq(1)').text();
        var proPic = $(this).find('td:eq(2)').text();
        var gender = $(this).find('td:eq(3)').text();
        var status = $(this).find('td:eq(4)').text();
        var attachedBranch = $(this).find('td:eq(5)').text();
        var designation = $(this).find('td:eq(6)').text();
        var role = $(this).find('td:eq(7)').text();
        var dob = $(this).find('td:eq(8)').text();
        var joinDate = $(this).find('td:eq(9)').text();
        var address = $(this).children().eq(10).text();

        let addressComponents = address.split(', ');
        let address1 = addressComponents[0] || '';
        let address2 = addressComponents[1] || '';
        let address3 = addressComponents[2] || '';

        var contact = $(this).find('td:eq(11)').text();
        var email = $(this).find('td:eq(12)').text();
        var guardian = $(this).find('td:eq(13)').text();
        var emergContact = $(this).find('td:eq(14)').text();

        $("#employeeCode").val(employeeCode);
        $("#employeeName").val(employeeName);
        $("#proPic").val(proPic);
        $("#gender").val(gender);
        $("#status").val(status);
        $("#attachedBranch").val(attachedBranch);
        $("#designation").val(designation);
        $("#role").val(role);
        $("#dob").val(dob);
        $("#joinDate").val(joinDate);
        $("#addressLine01").val(address1);
        $("#addressLine02").val(address2);
        $("#addressLine03").val(address3);
        $("#contact").val(contact);
        $("#email").val(email);
        $("#guardian").val(guardian);
        $("#emergContact").val(emergContact);

    })*/

    $(document).ready(function() {
        var selectedRow;

        // Handle table row click
        $('#employeeTable').on('click', 'tr', function() {
            selectedRow = $(this);

            var employeeCode = selectedRow.find('td:eq(0)').text();
            var employeeName = selectedRow.find('td:eq(1)').text();
            var proPic = selectedRow.find('td:eq(2)').text();
            var gender = selectedRow.find('td:eq(3)').text();
            var status = selectedRow.find('td:eq(4)').text();
            var attachedBranch = selectedRow.find('td:eq(5)').text();
            var designation = selectedRow.find('td:eq(6)').text();
            var role = selectedRow.find('td:eq(7)').text();
            var dob = selectedRow.find('td:eq(8)').text();
            var joinDate = selectedRow.find('td:eq(9)').text();
            var address = selectedRow.children().eq(10).text();

            let addressComponents = address.split(', ');
            let address1 = addressComponents[0] || '';
            let address2 = addressComponents[1] || '';
            let address3 = addressComponents[2] || '';

            var contact = selectedRow.find('td:eq(11)').text();
            var email = selectedRow.find('td:eq(12)').text();
            var guardian = selectedRow.find('td:eq(13)').text();
            var emergContact = selectedRow.find('td:eq(14)').text();

            console.log("Setting values from selected row:");
            console.log("employeeCode:", employeeCode);
            console.log("employeeName:", employeeName);
            console.log("proPic:", proPic); // Debug: Log proPic value
            console.log("gender:", gender);
            console.log("status:", status);
            console.log("attachedBranch:", attachedBranch);
            console.log("designation:", designation);
            console.log("role:", role);
            console.log("dob:", dob);
            console.log("joinDate:", joinDate);
            console.log("address:", address);
            console.log("contact:", contact);
            console.log("email:", email);
            console.log("guardian:", guardian);
            console.log("emergContact:", emergContact);

            $("#employeeCode").val(employeeCode);
            $("#employeeName").val(employeeName);
            $("#proPicBase64").val(proPic); // Ensure this ID matches your HTML
            $("#gender").val(gender);
            $("#status").val(status);
            $("#attachedBranch").val(attachedBranch);
            $("#designation").val(designation);
            $("#role").val(role);
            $("#dob").val(dob);
            $("#joinDate").val(joinDate);
            $("#addressLine01").val(address1);
            $("#addressLine02").val(address2);
            $("#addressLine03").val(address3);
            $("#contact").val(contact);
            $("#email").val(email);
            $("#guardian").val(guardian);
            $("#emergContact").val(emergContact);
        });

        // Handle file input change
        $('#proPic').on('change', function(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const base64String = e.target.result;
                    console.log("File read as base64:", base64String); // Debug: Log base64 string
                    if (selectedRow) {
                        selectedRow.find('td:eq(2)').text(base64String);
                        $("#proPicBase64").val(base64String);
                    }
                };
                reader.readAsDataURL(file);
            }
        });
    });


    $("#btnUpdateEmployee").click(function (){
        updateEmployee()
    })

    function updateEmployee(){
        const employeeCode = document.getElementById('employeeCode').value;
        const employeeName = document.getElementById('employeeName').value;
        const proPic = document.getElementById('proPic').value;
        const gender = document.getElementById('gender').value;
        const status= document.getElementById('status').value;
        const attachedBranch = document.getElementById('attachedBranch').value;
        const designation = document.getElementById('designation').value;
        const role = document.getElementById('role').value;
        const dob = document.getElementById('dob').value;
        const joinDate = document.getElementById('joinDate').value;
        const addressLine01 = document.getElementById('addressLine01').value;
        const addressLine02 = document.getElementById('addressLine02').value;
        const addressLine03 = document.getElementById('addressLine03').value;
        const contact = document.getElementById('contact').value;
        const email = document.getElementById('email').value;
        const guardian = document.getElementById('guardian').value;
        const emergContact = document.getElementById('emergContact').value;

        const employee = {
            employeeCode:employeeCode,
            employeeName:employeeName,
            proPic:proPic,
            gender:gender,
            status:status,
            attachedBranch:attachedBranch,
            designation:designation,
            role:role,
            dob:dob,
            joinDate:joinDate,
            address:`${addressLine01},${addressLine02},${addressLine03}`,
            contact:contact,
            email:email,
            guardian:guardian,
            emergContact:emergContact
        }

        $.ajax({
            url: 'http://localhost:8080/employee/update',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(employee),
            success: function (response) {
                console.log(response);
                alert('Employees information updated successfully!');
                getAllEmployees();
            },
            error: function (xhr, status, error) {
                console.error(error);
                alert('Failed to save employee information. Please try again.');
            }
        });
    }

    $(document).ready(function () {
        getAllEmployees();

        $('#btnDeleteEmployee').on('click', function() {
            var employeeCode = $('#employeeCode').val();
            if (employeeCode !== "") {
                deleteCustomer(employeeCode);
            } else {
                alert("Please select a employee to delete.");
            }
        });
    });

    function deleteCustomer(employeeCode) {
        $.ajax({
            url: `http://localhost:8080/employee/delete/${employeeCode}`, // Use backticks for template literal
            type: 'DELETE',
            success: function (response) {
                console.log(response);
                alert('Employee deleted successfully!');
                getAllEmployees();
            },
            error: function (xhr, status, error) {
                console.error(error);
                alert('Failed to delete employee. Please try again.');
            }
        });
    }

    $(document).ready(function () {
        getAllEmployees();
    });


    function generateEmployeeID() {
        $("#employeeCode").val("C00-001");
        $.ajax({
            url: "http://localhost:8080/employee/EmployeeIdGenerate",
            method: "GET",
            contentType: "application/json",
            dataType: "json",
            success: function (resp) {
                let id = resp.value;
                console.log("id" +id);

                if (id === null){
                    $("#employeeCode").val("E00-001" );
                } else {
                    let tempId = parseInt(id.split("-")[1]);
                    tempId = tempId + 1;
                    if (tempId <= 9) {
                        $("#employeeCode").val("E00-00" + tempId);
                    } else if (tempId <= 99) {
                        $("#employeeCode").val("E00-0" + tempId);
                    } else {
                        $("#employeeCode").val("E00-" + tempId);
                    }
                }
            },
            error: function (ob, statusText, error) {

            }
        });
    }

    $(document).ready(function () {
        getAllEmployees();
    });

    function employeeCapitalizeFirstLetter(str) {
        return str.charAt(0).toUpperCase() + str.slice(1).toLowerCase();
    }
</script>

</body>
</html>